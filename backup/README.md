# Система бэкапов

Эта директория содержит бэкапы базы данных проекта.

## Структура

```
backup/
├── database/          # Бэкапы базы данных SQLite
│   ├── referral_orders_20250115_120000.db
│   ├── referral_orders_20250116_120000.db
│   └── ...
└── README.md         # Этот файл
```

## Формат имен файлов

Бэкапы базы данных имеют формат:
```
referral_orders_YYYYMMDD_HHMMSS.db
```

Где:
- `YYYYMMDD` - дата создания (год, месяц, день)
- `HHMMSS` - время создания (час, минута, секунда)

Пример: `referral_orders_20250115_143022.db` - бэкап создан 15 января 2025 года в 14:30:22

## Создание бэкапа

### Простой способ

Запустите скрипт `backup.py` из корневой директории проекта:

```bash
python backup.py
```

### С параметрами

```bash
# Указать другой путь к БД
python backup.py --source path/to/database.db

# Указать другую директорию для бэкапов
python backup.py --backup-dir custom/backup/path

# Пропустить проверку целостности
python backup.py --no-integrity-check
```

### Просмотр списка бэкапов

```bash
python backup.py --list
```

### Очистка старых бэкапов

Оставить только последние 10 бэкапов:

```bash
python backup.py --cleanup 10
```

## Восстановление из бэкапа

### Интерактивный режим (рекомендуется)

Запустите скрипт `restore.py` без параметров:

```bash
python restore.py
```

Скрипт покажет список всех доступных бэкапов и предложит выбрать нужный.

### Восстановление конкретного бэкапа

```bash
python restore.py --backup backup/database/referral_orders_20250115_120000.db
```

### Просмотр списка бэкапов

```bash
python restore.py --list
```

### Дополнительные параметры

```bash
# Не создавать бэкап текущей БД перед восстановлением
python restore.py --backup path/to/backup.db --no-backup-before

# Пропустить проверку целостности
python restore.py --backup path/to/backup.db --no-integrity-check
```

## Работа с Git

### Добавление бэкапа в Git

После создания бэкапа:

```bash
# 1. Создать бэкап
python backup.py

# 2. Проверить изменения
git status

# 3. Добавить бэкап
git add backup/database/referral_orders_*.db

# 4. Закоммитить
git commit -m "Backup: database snapshot 2025-01-15"

# 5. Запушить (если есть удаленный репозиторий)
git push
```

### Рекомендации

- Коммитьте бэкапы в отдельные коммиты (не смешивайте с изменениями кода)
- Используйте понятные сообщения коммитов: `"Backup: database snapshot YYYY-MM-DD"`
- Периодически очищайте старые бэкапы из Git истории для уменьшения размера репозитория

## Частота бэкапов

Рекомендуется создавать бэкапы:

- **Перед важными изменениями** в коде или структуре БД
- **После значительных обновлений данных** (например, после синхронизации заказов)
- **Регулярно** (например, раз в день или раз в неделю)
- **Перед обновлением зависимостей** или миграциями БД

## Безопасность

⚠️ **Важно:**

- Бэкапы базы данных могут содержать персональные данные
- Если репозиторий **публичный**, не коммитьте бэкапы в Git
- Для **приватного** репозитория бэкапы в Git приемлемы
- Рассмотрите возможность шифрования бэкапов перед коммитом (опционально)

## Проверка целостности

Оба скрипта (`backup.py` и `restore.py`) автоматически проверяют целостность базы данных:

- Перед созданием бэкапа
- Перед восстановлением из бэкапа
- После восстановления

Если целостность не подтверждена, скрипт предупредит вас и спросит подтверждение.

## Автоматическая очистка

Для управления количеством бэкапов используйте опцию `--cleanup`:

```bash
# Оставить только последние 5 бэкапов
python backup.py --cleanup 5
```

Старые бэкапы будут удалены, останутся только самые свежие.

## Устранение неполадок

### Ошибка: "База данных не найдена"

Убедитесь, что файл `referral_orders.db` существует в корневой директории проекта, или укажите правильный путь через параметр `--source`.

### Ошибка: "Целостность БД не подтверждена"

Это может означать, что база данных повреждена. Попробуйте:

1. Создать бэкап текущей БД (если возможно)
2. Восстановить из последнего рабочего бэкапа
3. Проверить логи приложения на наличие ошибок

### Ошибка: "Недостаточно места на диске"

Убедитесь, что на диске достаточно свободного места для создания бэкапа. Размер бэкапа равен размеру исходной базы данных.

## Дополнительная информация

- Скрипты автоматически создают директорию `backup/database/` при первом запуске
- Перед восстановлением автоматически создается бэкап текущей БД (если она существует)
- Все операции безопасны и не удаляют данные без подтверждения



